class StateManager{constructor(prefix){this.prefix=prefix;this.vals={};this.setters={}}
add_key(name,callback){this.setters[name]=callback}
encode(state_object){return encodeURIComponent(btoa(JSON.stringify(state_object)))}
decode(encoded_string){return JSON.parse(atob(decodeURIComponent(encoded_string)))}
set_url(){var state_string=this.encode(this.vals);var previous=location.search.substring(1);var p_var=previous?JSON.parse('{"'+previous.replace(/&/g,'","').replace(/=/g,'":"')+'"}',function(key,value){return key===""?value:decodeURIComponent(value)}):{}
p_var[this.prefix]=state_string;var params=Object.keys(p_var).map((i)=>i+'='+p_var[i]).join('&');window.history.replaceState({},document.title,location.pathname+"?"+params)}
get_url_state(){var previous=location.search.substring(1);var p_var=previous?JSON.parse('{"'+previous.replace(/&/g,'","').replace(/=/g,'":"')+'"}',function(key,value){return key===""?value:decodeURIComponent(value)}):{}
return p_var[this.prefix]}
clear_url(){var previous=location.search.substring(1);var p_var=previous?JSON.parse('{"'+previous.replace(/&/g,'","').replace(/=/g,'":"')+'"}',function(key,value){return key===""?value:decodeURIComponent(value)}):{}
delete p_var[this.prefix];var params=Object.keys(p_var).map((i)=>i+'='+p_var[i]).join('&');window.history.replaceState({},document.title,location.pathname+"?"+params)}
initialize(state){for(var i in state){if(i in this.setters){this.setters[i](state[i])}}}
to_storage(key){localStorage.setItem(key,this.get_url_state())}
from_storage(key){return localStorage.getItem(key)}}
